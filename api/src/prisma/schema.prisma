generator client {
   provider = "prisma-client-js"
}

datasource db {
   provider  = "postgresql"
   url       = env("DATABASE_URL")
   directUrl = env("DIRECT_URL")
}

enum OrderStatus {
   PENDING
   IN_PROGRESS
   READY
   DELIVERED
   CLAIMED
   COMPLETED
   CANCELLED
}

model Client {
   id          String @id @default(cuid())
   name        String
   contactName String
   address     String
   phone       String
   email       String

   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt

   orders Order[] @relation("ClientOrders")
}

model Article {
   id         String @id @default(cuid())
   name       String @unique @db.Citext //case-insensitive text (guarda el casing original)
   basePrice  Int    @default(0)
   code       String @unique
   categoryId String

   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt

   category ArticleCategory @relation(fields: [categoryId], references: [id])

   @@index([categoryId])
}

model ArticleCategory {
   id        String   @id @default(cuid())
   name      String   @unique @db.Citext
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt

   articles Article[]
}

model ClientArticlePrice {
   clientId  String
   articleId String
   price     Int

   @@id([clientId, articleId])
   @@index([articleId])
}

model Order {
   id   String @id @default(cuid())
   code String @unique

   clientId      String
   status        OrderStatus @default(PENDING)
   observation   String?     @default("")
   articles      Json[] // { articleId, quantity, clientPrice }
   articlesCount Int         @default(0)
   totalPrice    Int         @default(0)

   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt

   client Client @relation("ClientOrders", fields: [clientId], references: [id])
}
